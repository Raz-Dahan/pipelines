apiVersion: v1
kind: Pod
metadata:
  name: "redis-response-test"
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: redis-test
      image: redis
      command: ["sh", "-c"]
      args:
        - "redis-cli -h redis -p 6379 ping"
  restartPolicy: Never

---
apiVersion: v1
kind: Pod
metadata:
  name: "flask-app-http-test"
  annotations:
    "helm.sh/hook": test
spec:
  initContainers:
    - name: wait-for-redis
      image: redis
      command: ["sh", "-c"]
      args:
        - |
          until redis-cli -h redis -p 6379 ping; do
            echo "Waiting for Redis to be ready..."
            sleep 5
          done
  containers:
    - name: http-test
      image: razdahan31/flask-k8s:{{ .Values.VER }}
      command: ["sh", "-c"]
      args:
        - "curl http://flask-service.default.svc.cluster.local"
  restartPolicy: Never
